function GetProductsForVk(n){for(var t,r,u=[],f=n.length,i=0;i<f;i++)t=n[i],t.SendVk&&(r={id:t.SeoId,price:t.UnitPrice},t.VkRecommendedIds&&t.VkRecommendedIds.length>0&&(r.recommended_ids=t.VkRecommendedIds),u.push(r));return u}function FindProductBySeoId(n,t){for(var i,f,r=[],e=n.length,u=0;u<e;u++)if(i=n[u],i.SeoId==t&&i.SendVk)return f={id:i.SeoId,price:i.UnitPrice},r.push(f),r;return r}function getSeoId(n,t){var i="A";return n==1?i="B":n==2?i="D":n==7&&(i="C"),t+i}function vk_click_send_event(n,t,i){var e=getSeoId(n,t),r=window.MbPageInfo,f,u;r&&n==0&&r.Products&&r.Products.length>0?(f=FindProductBySeoId(r.Products,e),f.length==1&&(u={products:f,business_value:1e3,currency_code:"RUR",category_ids:f[0].CategoryId},r.R46SearchString&&r.R46SearchString.length>0&&(u.search_string=r.R46SearchString),VK.Retargeting.ProductEvent(r.VkDinRetPriceId,i,u))):n==0&&(u={products:[{id:e}]},VK.Retargeting.ProductEvent(r.VkDinRetPriceId,i,u))}window.SendPageEventsVK=function(){var n,i,u,r,t;try{if(window.MbPageInfo){if(n=window.MbPageInfo,n.VkDinRetPriceId&&n.VkDinRetPriceId.length>0)if(n.PageTypeStr=="Product"&&n.CatalogType==0)n.Products&&(i=n.Products[0],i.SendVk&&(t={products:GetProductsForVk(n.Products),business_value:1e3,currency_code:"RUR",category_ids:i.CategoryId},i.VkRecommendedIds&&i.VkRecommendedIds.length>0&&(t.products_recommended_ids=i.VkRecommendedIds),n.R46SearchString&&n.R46SearchString.length>0&&(t.search_string=n.R46SearchString),VK.Retargeting.ProductEvent(n.VkDinRetPriceId,"view_product",t)));else if(n.PageTypeStr=="Search"&&n.CatalogType==0)n.Products&&(t={products:GetProductsForVk(n.Products),business_value:1e3,currency_code:"RUR"},n.R46SearchString&&n.R46SearchString.length>0&&(t.search_string=n.R46SearchString),VK.Retargeting.ProductEvent(n.VkDinRetPriceId,"view_search",t));else if((n.PageTypeStr=="Home"||n.PageTypeStr=="Category")&&n.CatalogType==0){var o=n.PageTypeStr=="Home"?"view_home":"view_category",f="",e=GetProductsForVk(n.Products);if(e.length<1)return;if(n.ProductCategories&&(u=n.ProductCategories.length,u>0))for(r=0;r<u;r++)f+=n.ProductCategories[r],r<u-1&&(f+=",");t={products:e,business_value:1e3,currency_code:"RUR",category_ids:f};n.R46SearchString&&n.R46SearchString.length>0&&(t.search_string=n.R46SearchString);VK.Retargeting.ProductEvent(n.VkDinRetPriceId,o,t)}else n.PageTypeStr=="Cart"&&n.Event?n.Event=="Basket_Remove"&&(t={products:[{id:n.Products[0].SeoId}]},VK.Retargeting.ProductEvent(n.VkDinRetPriceId,"remove_from_cart",t)):n.PageTypeStr=="OrderForm"&&n.Event?n.Event=="Create"&&(t={products:GetProductsForVk(n.Products),business_value:1e3,currency_code:"RUR"},VK.Retargeting.ProductEvent(n.VkDinRetPriceId,"init_checkout",t)):VK.Retargeting.ProductEvent(n.VkDinRetPriceId,"view_other","")}else VK.Retargeting.ProductEvent(5178,"view_other","")}catch(s){}};window.SendPageEventsR46=function(){var n,t,i;try{window.MbPageInfo&&(n=window.MbPageInfo,n.PageTypeStr=="Product"?n.Products&&(t=n.Products[0],i={id:t.SeoId,stock:t.Stock>0?!0:!1},window.r46("track","view",i)):n.PageTypeStr=="Category"?window.r46("track","category",n.ParentCategory):n.PageTypeStr=="Cart"&&n.Event&&n.Event.length>0&&n.Event=="Basket_Remove"&&window.r46("track","remove_from_cart",n.Products[0].SeoId))}catch(r){}};window.Add_to_cart_send_event=function(n,t){r46("track","cart",getSeoId(n,t));vk_click_send_event(n,t,"add_to_cart")};window.Add_to_wish_send_event=function(n,t){vk_click_send_event(n,t,"add_to_wishlist")};window.Remove_from_wish_send_event=function(n,t){vk_click_send_event(n,t,"remove_from_wishlist")};window.Add_payment_info_send_event=function(){var t,n,i;try{if(t=$("#add_payment_info_sent").val()=="1",!t&&window.MbPageInfo){n=window.MbPageInfo;i={products:GetProductsForVk(n.Products),business_value:1e3,currency_code:"RUR"};$("#add_payment_info_sent").val("1");try{VK.Retargeting.ProductEvent(n.VkDinRetPriceId,"add_payment_info",i)}catch(r){}}}catch(r){}};window.Purchase_send_event=function(n){var i,o;try{if(window.MbPageInfo&&window.MbPageInfo.Basket){var t=window.MbPageInfo,u=[],f=0,s=t.Basket.Items.length;for(i=0;i<s;i++){var r=t.Basket.Items[i].product,e=t.Basket.Items[i].quantity,h={id:r.SeoId,price:r.UnitPrice,amount:e};f+=r.UnitPrice*e;u.push(h)}try{window.r46("track","purchase",{products:u,order:n,order_price:f})}catch(c){}try{o={products:GetProductsForVk(t.Products),business_value:1e3,currency_code:"RUR"};VK.Retargeting.ProductEvent(t.VkDinRetPriceId,"purchase",o)}catch(c){}}}catch(c){}};