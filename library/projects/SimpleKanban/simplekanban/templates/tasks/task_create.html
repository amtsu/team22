{% extends 'base.html' %}
{% load static %}

{% block title %}Создание задачи - SuperKanban{% endblock %}

{% block content %}
<style>
  .btn-orange {
    background-color: #ff6f00;
    color: white;
    border: none;
  }

  .btn-orange:hover {
    background-color: #e65c00;
  }

  .form-control:focus {
    border-color: #ff6f00;
    box-shadow: 0 0 5px rgba(255, 111, 0, 0.5);
  }
</style>

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <section id="task-form" class="section shadow p-4 mb-5 bg-white rounded">
        <form method="post" novalidate>
          {% csrf_token %}

          <h3 class="mb-4">Создание задачи</h3>
          {% if form.errors %}
            <div class="alert alert-danger">
              <ul>
                {% for error in form.non_field_errors %}
                  <li>{{ error }}</li>
                {% endfor %}
                {% for field, errors in form.errors.items %}
                  <li>{{ field }}: {{ errors|join:", " }}</li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}

          <!-- Поле Название задачи -->
          <div class="form-group mb-3">
            {{ form.title.label_tag }}
            {{ form.title }}
          </div>

          <!-- Поле Описание задачи -->
          <div class="form-group mb-3">
            {{ form.description.label_tag }}
            {{ form.description }}
          </div>

          <!-- Поле Исполнитель -->
          <div class="form-group mb-3">
            {{ form.assigned_user.label_tag }}
            {{ form.assigned_user }}
          </div>

          <!-- Поле Дата выполнения -->
          <div class="form-group mb-3">
            {{ form.due_date.label_tag }}
            {{ form.due_date }}
          </div>

          <!-- Поле Статус -->
          <div class="form-group mb-3">
            {{ form.execution_status.label_tag }}
            {{ form.execution_status }}
          </div>

          <!-- Подзадачи -->
          <section id="subtasks">
            <h4 class="mb-3">Подзадачи</h4>
            {{ subtasks.management_form }}
            <div id="subtasks-container">
              {% for form in subtasks %}
                <div class="form-group shadow-sm p-3 mb-3 bg-light rounded">
                  <h5>Подзадача {{ forloop.counter }}</h5>
                  <div>
                    {{ form.title.label_tag }}
                    {{ form.title }}
                  </div>
                  <div>
                    {{ form.task.label_tag }}
                    {{ form.task }}
                  </div>
                  <button type="button" class="btn btn-danger remove-subtask mt-2">Удалить подзадачу</button>
                </div>
              {% endfor %}
            </div>
            <button type="button" id="add-subtask" class="btn btn-primary mt-3">Добавить подзадачу</button>
          </section>

          <div class="text-center mt-4">
            <button type="submit" class="btn btn-orange btn-lg">Создать!</button>
          </div>
        </form>
      </section>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const subtasksContainer = document.getElementById('subtasks-container');
    const addSubtaskButton = document.getElementById('add-subtask');
    let totalForms = document.getElementById('id_subtasks-TOTAL_FORMS');

    addSubtaskButton.addEventListener('click', function () {
      const newFormIndex = totalForms.value;
      const emptyFormHtml = `
        <div class="form-group shadow-sm p-3 mb-3 bg-light rounded">
          <h5>Подзадача ${parseInt(newFormIndex) + 1}</h5>
          <div>
            <label for="id_subtasks-${newFormIndex}-title">Название подзадачи:</label>
            <input type="text" name="subtasks-${newFormIndex}-title" class="form-control" id="id_subtasks-${newFormIndex}-title">
          </div>
          <div>
            <label for="id_subtasks-${newFormIndex}-task">Задача:</label>
            <select name="subtasks-${newFormIndex}-task" class="form-control" id="id_subtasks-${newFormIndex}-task">
              <option value="">---------</option>
              {% for task in form.instance.task_set.all %}
                <option value="{{ task.id }}">{{ task.title }}</option>
              {% endfor %}
            </select>
          </div>
          <button type="button" class="btn btn-danger remove-subtask mt-2">Удалить подзадачу</button>
        </div>
      `;
      subtasksContainer.insertAdjacentHTML('beforeend', emptyFormHtml);
      totalForms.value = parseInt(newFormIndex) + 1;
    });

    subtasksContainer.addEventListener('click', function (e) {
      if (e.target.classList.contains('remove-subtask')) {
        e.target.closest('.form-group').remove();
        totalForms.value = subtasksContainer.querySelectorAll('.form-group').length;
      }
    });
  });
</script>
{% endblock %}


{#{% extends 'base.html' %}#}
{#{% load static %}#}
{##}
{#{% block title %}Создание задачи - SuperKanban{% endblock %}#}
{##}
{#{% block content %}#}
{#<div class="container">#}
{#  <div class="row">#}
{#    <div class="col-lg-8">#}
{##}
{#      <!-- Форма создания задачи -->#}
{#      <section id="task-form" class="section">#}
{#        <div class="container">#}
{#          <form action="{% url 'task_create' company_id=company_id %}" method="post">#}
{#            {% csrf_token %}#}
{#            <h4>Создаем задачу</h4>#}
{#            <p>Необходимо заполнить следующие поля. Обязательные поля помечены *</p>#}
{##}
{#            <div class="row">#}
{#              <div class="col-md-6 form-group">#}
{#                <input name="name" type="text" class="form-control" placeholder="Имя исполнителя*" required>#}
{#              </div>#}
{#              <div class="col-md-6 form-group">#}
{#                <input name="due_date" type="date" class="form-control" placeholder="Дата выполнения*" required>#}
{#              </div>#}
{#            </div>#}
{##}
{#            <div class="row">#}
{#              <div class="col form-group">#}
{#                <textarea name="description" class="form-control" placeholder="Описание задачи*" required></textarea>#}
{#              </div>#}
{#            </div>#}
{##}
{#            <div class="text-center">#}
{#              <button type="submit" class="btn btn-primary">Создать!</button>#}
{#            </div>#}
{#          </form>#}
{#        </div>#}
{#      </section>#}
{##}
{#      <!-- Форма создания подзадачи -->#}
{#      <section id="subtask-form" class="subtask-form section mt-5">#}
{#        <div class="container">#}
{#          <form action="" method="post">#}
{#            {% csrf_token %}#}
{#            <h4>Создаем подзадачу</h4>#}
{#            <p>Необходимо заполнить следующие поля. Обязательные поля помечены *</p>#}
{##}
{#            <div class="row">#}
{#              <div class="col-md-6 form-group">#}
{#                <input name="subtask_name" type="text" class="form-control" placeholder="Имя исполнителя подзадачи*" required>#}
{#              </div>#}
{#              <div class="col-md-6 form-group">#}
{#                <input name="subtask_date" type="date" class="form-control" placeholder="Дата выполнения подзадачи*" required>#}
{#              </div>#}
{#            </div>#}
{##}
{#            <div class="row">#}
{#              <div class="col form-group">#}
{#                <textarea name="subtask_description" class="form-control" placeholder="Описание подзадачи*" required></textarea>#}
{#              </div>#}
{#            </div>#}
{##}
{#            <div class="text-center">#}
{#              <button type="submit" class="btn btn-primary">Создать подзадачу</button>#}
{#            </div>#}
{#          </form>#}
{#        </div>#}
{#      </section>#}
{##}
{#    </div>#}
{#  </div>#}
{#</div>#}
{#{% endblock %}#}
